# –ü–û–¢–û–ö–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-21  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## 1. –ü–û–¢–û–ö /START

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/start`.

### –®–∞–≥–∏

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —è–∑—ã–∫–∞**
   - –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä —è–∑—ã–∫–∞
   - –ö–Ω–æ–ø–∫–∏: "üá∑üá∫ –†—É—Å—Å–∫–∏–π", "üá¨üáß English"
   - Callback: `language_select:ru` / `language_select:en`

2. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ**
   - –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Ö
   - –î–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç–µ–∫—É—â–∏–º –±–∞–ª–∞–Ω—Å–æ–º
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π, —Ç–∏–ø–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π, –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é**
   - –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `build_main_menu_keyboard()`
   - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:
     - "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è" ‚Üí `gen_type:`
     - "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å" ‚Üí `topup_balance`
     - "üí∞ –ë–∞–ª–∞–Ω—Å" ‚Üí `check_balance`
     - "üìö –ú–æ–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏" ‚Üí `my_generations`
     - "üéÅ –ü–æ–¥–∞—Ä–æ–∫" ‚Üí `claim_gift`
     - "‚ÑπÔ∏è –ü–æ–º–æ—â—å" ‚Üí `help_menu`
     - "üåê –Ø–∑—ã–∫" ‚Üí `change_language`

### –§–∞–π–ª—ã
- **Handler:** `bot_kie.py:start()` (—Å—Ç—Ä–æ–∫–∞ 2339)
- **–ú–µ–Ω—é:** `helpers.py:build_main_menu_keyboard()`

---

## 2. –ü–û–¢–û–ö –ì–õ–ê–í–ù–û–ì–û –ú–ï–ù–Æ

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

#### 2.1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (`gen_type:`)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è"
2. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–π:
   - –¢–µ–∫—Å—Ç ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - –¢–µ–∫—Å—Ç ‚Üí –≤–∏–¥–µ–æ
   - –ò —Ç.–¥.
3. Callback: `gen_type:text_to_image`
4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí `category:`

#### 2.2. –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (`topup_balance`)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
2. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å—É–º–º—ã: 50 ‚ÇΩ, 100 ‚ÇΩ, 150 ‚ÇΩ, –∏ —Ç.–¥.
3. Callback: `topup_amount:100`
4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã ‚Üí `pay_stars:` / `pay_sbp:`

#### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (`check_balance`)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üí∞ –ë–∞–ª–∞–Ω—Å"
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
3. –ö–Ω–æ–ø–∫–∞ "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å" ‚Üí `topup_balance`

#### 2.4. –ú–æ–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (`my_generations`)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üìö –ú–æ–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
3. –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: `gen_view:`, `gen_repeat:`

### –§–∞–π–ª—ã
- **–†–æ—É—Ç–µ—Ä:** `bot_kie.py:button_callback()` (—Å—Ç—Ä–æ–∫–∞ 2740)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:** –†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `bot_kie.py`

---

## 3. –ü–û–¢–û–ö –ü–û–ö–£–ü–ö–ò/–û–ü–õ–ê–¢–´

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–æ–ª–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ Telegram Stars –∏–ª–∏ –°–ë–ü.

### –®–∞–≥–∏

#### 3.1. –í—ã–±–æ—Ä —Å—É–º–º—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
2. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä—ã–µ —Å—É–º–º—ã: 50 ‚ÇΩ, 100 ‚ÇΩ, 150 ‚ÇΩ, 200 ‚ÇΩ, 500 ‚ÇΩ, 1000 ‚ÇΩ
3. –ò–ª–∏ "üí∞ –î—Ä—É–≥–∞—è —Å—É–º–º–∞" ‚Üí –≤–≤–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Å—É–º–º—ã (50-50000 ‚ÇΩ)
4. Callback: `topup_amount:100`
5. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `SELECTING_AMOUNT`

#### 3.2. –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
1. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–ø–æ—Å–æ–±—ã:
   - "‚≠ê Telegram Stars" ‚Üí `pay_stars:100`
   - "üí≥ –°–ë–ü / SBP" ‚Üí `pay_sbp:100`
2. Callback: `pay_stars:100` –∏–ª–∏ `pay_sbp:100`

#### 3.3. Telegram Stars (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ `send_invoice()`
2. –í–∞–ª—é—Ç–∞: XTR (Telegram Stars)
3. –°—É–º–º–∞: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä—É–±–ª–µ–π –≤ –∑–≤–µ–∑–¥—ã (–∫—É—Ä—Å 1.6: 1 —Ä—É–±–ª—å = 1.6 –∑–≤–µ–∑–¥)
4. Payload: `topup_{user_id}_{timestamp}`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≤ Telegram
6. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `pre_checkout_query_handler()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–∞—Ç–µ–∂
7. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `successful_payment_handler()` –∑–∞—á–∏—Å–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å
8. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `ConversationHandler.END`

#### 3.4. –°–ë–ü (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
1. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:
   - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: `PAYMENT_PHONE`
   - –ë–∞–Ω–∫: `PAYMENT_BANK`
   - –ü–æ–ª—É—á–∞—Ç–µ–ª—å: `PAYMENT_CARD_HOLDER`
2. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `WAITING_PAYMENT_SCREENSHOT`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç
4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `handle_payment_screenshot()`:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (file_id)
   - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - OCR –∞–Ω–∞–ª–∏–∑ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
   - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
5. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `ConversationHandler.END`

### –§–∞–π–ª—ã
- **Handler:** `bot_kie.py:button_callback()` ‚Üí `topup_balance`, `topup_amount:`, `pay_stars:`, `pay_sbp:`
- **OCR:** `bot_kie.py:analyze_payment_screenshot()` (—Å—Ç—Ä–æ–∫–∞ 2016)
- **Payment handlers:** `pre_checkout_query_handler()`, `successful_payment_handler()`

---

## 4. –ü–û–¢–û–ö –ì–ï–ù–ï–†–ê–¶–ò–ò

### –û–ø–∏—Å–∞–Ω–∏–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é: –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ ‚Üí –≤–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Üí –∑–∞–ø—É—Å–∫ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### –®–∞–≥–∏

#### 4.1. –í—ã–±–æ—Ä —Ç–∏–ø–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è"
2. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã: `gen_type:text_to_image`, `gen_type:image_to_image`, –∏ —Ç.–¥.
3. Callback: `gen_type:text_to_image`
4. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `SELECTING_MODEL`

#### 4.2. –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
1. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–¥–µ–ª–µ–π
2. Callback: `category:art`, `category:photo`, –∏ —Ç.–¥.
3. –ò–ª–∏ "üìã –í—Å–µ –º–æ–¥–µ–ª–∏" ‚Üí `all_models`

#### 4.3. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. Callback: `select_model:wan/2-6-text-to-video`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `user_sessions[user_id]['model_id']`
4. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `INPUTTING_PARAMS`

#### 4.4. –í–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏
2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–æ–¥–µ–ª–∏:
   - `prompt` (—Ç–µ–∫—Å—Ç) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
   - `image_input` (—Ñ–æ—Ç–æ) - –¥–ª—è image-to-* –º–æ–¥–µ–ª–µ–π
   - `video_input` (–≤–∏–¥–µ–æ) - –¥–ª—è video-to-* –º–æ–¥–µ–ª–µ–π
   - `duration`, `resolution`, –∏ —Ç.–¥. - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
3. Handler: `input_parameters()` (—Å—Ç—Ä–æ–∫–∞ ~4000+)
4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `user_sessions[user_id]['params']`
5. –ö–æ–≥–¥–∞ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–±—Ä–∞–Ω—ã:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é"
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ: `CONFIRMING_GENERATION`

#### 4.5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é"
2. Callback: `confirm_generate`
3. Handler: `confirm_generation()` (—Å—Ç—Ä–æ–∫–∞ ~6000+)
4. –ü—Ä–æ–≤–µ—Ä–∫–∏:
   - –ë–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω?
   - –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–Ω—ã?
5. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:
   - `kie.create_task()` –∏–ª–∏ `generation_service.create_generation()`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ `task_id`
6. –°–µ—Å—Å–∏—è –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ `active_generations[(user_id, task_id)]`
7. –ó–∞–ø—É—Å–∫ polling: `asyncio.create_task(poll_task_status(...))`
8. –°–æ—Å—Ç–æ—è–Ω–∏–µ: `ConversationHandler.END`

#### 4.6. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
1. Polling –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
2. Handler: `poll_task_status()` (—Å—Ç—Ä–æ–∫–∞ ~7000+)
3. –°—Ç–∞—Ç—É—Å—ã:
   - `pending` - –≤ –æ—á–µ—Ä–µ–¥–∏
   - `processing` - –≤ —Ä–∞–±–æ—Ç–µ
   - `completed` - –≥–æ—Ç–æ–≤–æ
   - `failed` - –æ—à–∏–±–∫–∞
4. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
   - –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
   - –û—á–∏—Å—Ç–∫–∞ `active_generations`

### –§–∞–π–ª—ã
- **Handlers:** `bot_kie.py:input_parameters()`, `confirm_generation()`, `poll_task_status()`
- **Service:** `app/services/generation_service.py`
- **Client:** `app/integrations/kie_client.py`

---

## 5. –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö

### –ì–ª–æ–±–∞–ª—å–Ω—ã–π error handler
- **–§–∞–π–ª:** `bot_kie.py:error_handler()` (—Å—Ç—Ä–æ–∫–∞ 26039)
- **–î–µ–π—Å—Ç–≤–∏—è:**
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ stacktrace
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–û—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"

### –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –í—Å–µ handlers –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `try-except`
- `query.answer()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ callback
- Fallback –Ω–∞ `reply_text` –µ—Å–ª–∏ `edit_message_text` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## 6. –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### UX –ü—Ä–∞–≤–∏–ª–∞
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å "KIE" –≤ UI
- ‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ `translations.py`
- ‚úÖ –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å `query.answer()` –¥–ª—è –∫–Ω–æ–ø–æ–∫
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è
- ConversationHandler —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏/–æ–ø–ª–∞—Ç—ã
- `user_sessions` —Ö—Ä–∞–Ω–∏—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `active_generations` —Ö—Ä–∞–Ω–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
