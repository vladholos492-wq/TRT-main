# ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É - –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Ñ–æ—Ä–º—É–ª–æ–π `official_usd √ó –∫—É—Ä—Å √ó 2`.

## üìã –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª—ë–Ω calculate_price_rub ‚úÖ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `app.services.pricing_service.price_for_model_rub()` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- –õ–æ–≥–∏—Ä—É–µ—Ç: `PRICE_RUB=<...> OFFICIAL_USD=<...> MULT=<...> RATE=<...>`
- Fallback –Ω–∞ 1‚ÇΩ –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –î–û —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ ‚úÖ
- **–ü–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ** (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 11879): —Å–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ `gateway.create_task()`
- **–í—Ç–æ—Ä–æ–µ –º–µ—Å—Ç–æ** (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 23758): —Å–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ `gateway.create_task()`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—É –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞: `price_for_model_rub(model_id, mode_index, settings)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
- –í DRY_RUN —Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (—É–∂–µ –±—ã–ª–æ –≤ –∫–æ–¥–µ)

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- `PRICE_RUB=<...> OFFICIAL_USD=<...> MULT=<...> RATE=<...> MODEL=<...> USER=<...>`
- `BALANCE VERIFIED: user_id=<...> deducted=<...> old_balance=<...> new_balance=<...> model=<...>`

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è db_update_user_balance ‚úÖ
- –î–ª—è —Ç–µ—Å—Ç–æ–≤/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ü—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ –ë–î

## üé® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –†–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥: `price_for_model_rub(model_id, mode_index, settings)`
- ‚úÖ –§–æ—Ä–º—É–ª–∞: `official_usd √ó USD_TO_RUB √ó PRICE_MULTIPLIER`
- ‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–Ω–æ–π –≤ –º–µ–Ω—é

### –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –î–û —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (–∞—Ç–æ–º–∞—Ä–Ω–æ)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ –í DRY_RUN –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –î–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `PRICE_RUB`, `OFFICIAL_USD`, `MULT`, `RATE` –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ `BALANCE VERIFIED` –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## üìä –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤

```
PRICE_RUB=5 OFFICIAL_USD=0.0250 MULT=2.0 RATE=100.0 MODEL=flux-2/pro-text-to-image USER=12345
BALANCE VERIFIED: user_id=12345 deducted=5 old_balance=100.00 new_balance=95.00 model=flux-2/pro-text-to-image
```

## ‚úÖ Acceptance Criteria

- ‚úÖ –¶–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = `price_for_model_rub(model_id)`
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–ª–∞–µ—Ç—Å—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ createTask
- ‚úÖ –í DRY_RUN —Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `PRICE_RUB`, `OFFICIAL_USD`, `MULT`, `RATE`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `db_update_user_balance` –¥–ª—è —Ç–µ—Å—Ç–æ–≤/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ `BALANCE VERIFIED` –≤ –ª–æ–≥–∞—Ö

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
–°–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏:
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ü–µ–Ω–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å
3. –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å
4. –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–¥–∞—á–∞

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
```python
from bot_kie import db_update_user_balance

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db_update_user_balance(user_id=12345, amount=100.0)
```

## üìù –í–∞–∂–Ω–æ

- **–¶–µ–Ω–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `price_for_model_rub()` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** –°–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –î–û —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- **DRY_RUN:** –í DRY_RUN —Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É —Å —Ñ–æ—Ä–º—É–ª–æ–π `official_usd √ó –∫—É—Ä—Å √ó 2`.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**

