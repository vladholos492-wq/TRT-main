# ‚úÖ QA/UX: –í–°–ï –ö–ù–û–ü–ö–ò, –ì–ï–ù–ï–†–ê–¶–ò–ò, SELF-HEAL - –ì–û–¢–û–í–û

**–î–∞—Ç–∞:** 2025-12-19

## üéØ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### 1. ‚úÖ Button System: 100% coverage + –∑–∞—â–∏—Ç–∞

**–°–æ–∑–¥–∞–Ω–æ:**
- `app/buttons/registry.py` - –µ–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
- `app/buttons/validator.py` - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
- `app/buttons/fallback.py` - fallback handler –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö callback'–æ–≤
- `app/buttons/integration.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å bot_kie.py

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ï–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö callback_data
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –º—ë—Ä—Ç–≤—ã—Ö –∫–Ω–æ–ø–æ–∫)
- ‚úÖ Fallback handler –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ–Ω—é –ø—Ä–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º callback
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö callback'–æ–≤

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
- ‚úÖ Fallback handler –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ —Ä–æ—É—Ç–µ—Ä—É

---

### 2. ‚úÖ Generations: –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–°–æ–∑–¥–∞–Ω–æ:**
- `app/generations/interface.py` - –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `GenerationResult` —Å –ø–æ–ª—è–º–∏:
  - `status` (pending/processing/completed/failed)
  - `output` (—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
  - `meta` (model_id, params, –∏ —Ç.–¥.)
  - `cost` (—Å—Ç–æ–∏–º–æ—Å—Ç—å)
  - `timings` (–º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏)
  - `prompt_preview` (–ø—Ä–µ–≤—å—é –ø—Ä–æ–º–ø—Ç–∞)
- ‚úÖ –ï–¥–∏–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ "—á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ"

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from app.generations.interface import GenerationResult, GenerationStatus, GenerationInterface

result = GenerationResult(
    status=GenerationStatus.COMPLETED,
    output="Generated text...",
    meta={"model_id": "gpt-4", "params": {...}},
    cost=0.5,
    timings={"total": 2.3}
)

message = GenerationInterface.create_result_message(result, user_lang='ru')
```

---

### 3. ‚úÖ Global Error Handling + Self-heal

**–°–æ–∑–¥–∞–Ω–æ:**
- `app/observability/error_guard.py` - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å self-healing

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ (ImportError, AttributeError, CallbackError, –∏ —Ç.–¥.)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ `IncidentBundle` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ `data/incidents/`
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∞–≤—Ç–æ—Ñ–∏–∫—Å—ã (whitelist –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤):
  - Missing handler ‚Üí fallback handler
  - Import error ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
  - Attribute error ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- ‚úÖ –†–µ–∂–∏–º –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á—ë–Ω –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É error_handler –≤ bot_kie.py
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

---

### 4. ‚úÖ Render Logs Connector

**–°–æ–∑–¥–∞–Ω–æ:**
- `scripts/render_logs.py` - —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–≥–æ–≤ Render
- `README_RENDER_LOGS.md` - quick start guide (3 —à–∞–≥–∞)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ `--list-services` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ `--tail/--follow` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã:
  - `--level ERROR|WARNING|INFO`
  - `--text "—Ç–µ–∫—Å—Ç"` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
  - `--since 15m|2h|1d` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ Service ID –∏–∑ `services_config.json`
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ Render API
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏ tail

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
python scripts/render_logs.py --service-id srv-xxxxx

# Tail —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
python scripts/render_logs.py --service-id srv-xxxxx --tail --level ERROR --since 1h
```

---

### 5. ‚úÖ Smoke Test

**–°–æ–∑–¥–∞–Ω–æ:**
- `tests/test_buttons_smoke.py` - smoke test –¥–ª—è –∫–Ω–æ–ø–æ–∫

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –¢–µ—Å—Ç Button Registry
- ‚úÖ –¢–µ—Å—Ç Callback Router
- ‚úÖ –¢–µ—Å—Ç Button Validator
- ‚úÖ Smoke flow - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫

**–ó–∞–ø—É—Å–∫:**
```bash
python tests/test_buttons_smoke.py
```

---

## üìã –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í BOT_KIE.PY

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ:
```python
# –í main() –¥–æ–±–∞–≤–ª–µ–Ω–æ:
from app.buttons.integration import validate_buttons_on_startup
validate_buttons_on_startup(project_root)
```

### Self-heal –≤ error handler:
```python
# –í error_handler() –¥–æ–±–∞–≤–ª–µ–Ω–æ:
from app.observability.error_guard import ErrorGuard
error_guard = ErrorGuard(project_root)
fixed = await error_guard.handle_error(error, update, context, user_id, callback_data)
```

---

## ‚úÖ DEFINITION OF DONE

### ‚úÖ "–ö–Ω–æ–ø–æ—á–Ω—ã–π" smoke-test –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ/CI
- –°–æ–∑–¥–∞–Ω `tests/test_buttons_smoke.py`
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç registry, router, validator
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ callback'—ã

### ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–ª–æ—É –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- Fallback handler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ callback'—ã
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ–Ω—é –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### ‚úÖ –ü—Ä–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–π –ø–æ–ª–æ–º–∫–µ callback'–∞ –±–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ–Ω—é
- Fallback handler –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### ‚úÖ Render logs tail —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ API-–∫–ª—é—á—É –∏ service id
- `scripts/render_logs.py` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç tail/follow
- –§–∏–ª—å—Ç—Ä—ã –ø–æ —É—Ä–æ–≤–Ω—é, —Ç–µ–∫—Å—Ç—É, –≤—Ä–µ–º–µ–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ Service ID –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

---

## üöÄ –ß–¢–û –î–ê–õ–¨–®–ï

### –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **–ó–∞–º–µ–Ω–∞ button_callback –Ω–∞ —Ä–æ—É—Ç–µ—Ä:**
   - –ú–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ ButtonRegistry
   - –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –∫–∞–∫ fallback

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GenerationInterface:**
   - –û–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ `GenerationResult`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ

3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ self-heal:**
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –∞–≤—Ç–æ—Ñ–∏–∫—Å–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Cursor AI –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:**
- `app/buttons/` - 4 —Ñ–∞–π–ª–∞ (registry, validator, fallback, integration)
- `app/observability/` - 1 —Ñ–∞–π–ª (error_guard)
- `app/generations/` - 1 —Ñ–∞–π–ª (interface)
- `scripts/render_logs.py` - —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- `tests/test_buttons_smoke.py` - smoke test
- `README_RENDER_LOGS.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ Self-heal –≤ error handler
- ‚úÖ Fallback handler –¥–ª—è callback'–æ–≤

---

## ‚úÖ –ò–¢–û–ì

- ‚úÖ Button System —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ fallback
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- ‚úÖ Global Error Handling —Å self-heal
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π Render Logs Connector
- ‚úÖ Smoke test –¥–ª—è –∫–Ω–æ–ø–æ–∫
- ‚úÖ –í—Å—ë –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ bot_kie.py
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

**–í–°–Å –ì–û–¢–û–í–û! –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.**







