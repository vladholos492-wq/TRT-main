# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Input Builder –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω—ã —Å—Ö–µ–º—ã –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚úÖ
- `app/kie_catalog/input_schemas.py` - whitelist –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –º–æ–¥–µ–ª–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤: t2i, i2i, t2v, i2v, v2v, tts, stt, sfx, audio_isolation, upscale, bg_remove, watermark_remove, music, lip_sync
- –ê–ª–∏–∞—Å—ã –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–µ–π (img‚Üíimage_url, neg‚Üínegative_prompt –∏ —Ç.–¥.)
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞

### 2. –°–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π builder ‚úÖ
- `app/services/kie_input_builder.py` - —Ñ—É–Ω–∫—Ü–∏—è `build_input()`
- –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª—è —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã
- –£–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω–∏–µ –∫–ª—é—á–∏ (whitelist)
- –°—Ç–∞–≤–∏—Ç –¥–µ—Ñ–æ–ª—Ç—ã –∏–∑ —Å—Ö–µ–º—ã –∏ –∏–∑ notes —Ä–µ–∂–∏–º–∞
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è (image –¥–ª—è i2i/i2v, text –¥–ª—è tts –∏ —Ç.–¥.)
- –ú—è–≥–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é ‚úÖ
- –û–±–Ω–æ–≤–ª—ë–Ω `bot_kie.py` - –¥–æ–±–∞–≤–ª–µ–Ω builder –ø–æ—Å–ª–µ `normalize_for_generation`
- Builder —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Ç–∏–ø—É –º–æ–¥–µ–ª–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ callback_url –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `MODEL=<id> TYPE=<type> INPUT_KEYS=[...]`

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### Whitelist –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ KIE API
- ‚úÖ –õ–∏—à–Ω–∏–µ –ø–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –º–æ–¥–µ–ª–µ–π

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –ê–ª–∏–∞—Å—ã: `img` ‚Üí `image_url`, `neg` ‚Üí `negative_prompt`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∫–æ–≤ (–±–µ—Ä—ë—Ç—Å—è –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç)
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω –ø–æ–ª–µ–π

### –î–µ—Ñ–æ–ª—Ç—ã
- ‚úÖ –ò–∑ —Å—Ö–µ–º—ã (width=1024 –¥–ª—è t2i, duration=5.0 –¥–ª—è t2v –∏ —Ç.–¥.)
- ‚úÖ –ò–∑ notes —Ä–µ–∂–∏–º–∞ (–ø–∞—Ä—Å–∏–Ω–≥ "5.0s" ‚Üí duration=5.0, "720p" ‚Üí resolution="720p")

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ú—è–≥–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è: "–ù—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ", "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (image_url/image_base64/image - —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `MODEL=<id> TYPE=<type> INPUT_KEYS=[...]`
- ‚úÖ –ë–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
- ‚úÖ Preview –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –ü—Ä–∏–º–µ—Ä—ã

### t2i (Text-to-Image)
```python
user_payload = {
    "prompt": "cat",
    "neg": "ugly",  # ‚Üí negative_prompt
    "width": 1024,
    "height": 1024
}
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è t2i
```

### i2i (Image-to-Image)
```python
user_payload = {
    "img": "https://...",  # ‚Üí image_url
    "prompt": "make it better",
    "strength": 0.75
}
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ image
```

### i2v (Image-to-Video)
```python
user_payload = {
    "image": "https://...",
    "prompt": "animate",
    "duration": 10.0
}
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ image, –¥–µ—Ñ–æ–ª—Ç—ã –∏–∑ notes
```

## ‚úÖ Acceptance Criteria

- ‚úÖ –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å "–ª–µ–≤—ã–µ" –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –æ–Ω–∏ –≤—ã—á–∏—â–∞—é—Ç—Å—è
- ‚úÖ –û—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –º—è–≥–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º —Ç–∏–ø–µ –º–æ–¥–µ–ª–∏
- ‚úÖ Callback URL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.kie_catalog import get_model
from app.services.kie_input_builder import build_input

model_spec = get_model("flux-2/pro-text-to-image")
built_input, error = build_input(model_spec, user_payload, mode_index=0)

if error:
    # –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    pass
else:
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å built_input –≤ KIE API
    result = await gateway.create_task(model_id, built_input, callback_url)
```

## üìù –í–∞–∂–Ω–æ

- **Whitelist:** –¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ú—è–≥–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–î–µ—Ñ–æ–ª—Ç—ã:** –ò–∑ —Å—Ö–µ–º—ã –∏ –∏–∑ notes —Ä–µ–∂–∏–º–∞
- **Callback URL:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `KIE_CALLBACK_URL` env

## üéâ –ì–æ—Ç–æ–≤–æ!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã. Input builder —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º.

