# üéØ –¢–û–ü-5 –ö–†–ò–¢–ò–ß–ù–´–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞:** 2025-12-25  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## üìä EXECUTIVE SUMMARY

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ä–µ–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 24 –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ KIE API.  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 23/24 –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (95.8% success rate).  
**–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:** 48.38 RUB.

---

## üî• –¢–û–ü-5 –ö–†–ò–¢–ò–ß–ù–´–• –ü–†–û–ë–õ–ï–ú –ò –†–ï–®–ï–ù–ò–Ø

### 1. ‚ùå FREE tier auto-setup (4 –≤–º–µ—Å—Ç–æ 5 –º–æ–¥–µ–ª–µ–π)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
Free tier auto-setup: 4 models  ‚Üê –ë–´–õ–û
FREE tier: 5 cheapest –º–æ–¥–µ–ª–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã  ‚Üê –û–ñ–ò–î–ê–õ–û–°–¨
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
Auto-setup –¥–æ–±–∞–≤–ª—è–ª –¢–û–õ–¨–ö–û –º–æ–¥–µ–ª–∏ —Å `rub_per_gen == 0`, –∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–ª–∞ 5 cheapest.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ  
–ò–∑–º–µ–Ω–∏–ª –ª–æ–≥–∏–∫—É –≤ [main_render.py](main_render.py#L250-L276):
- –¢–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç 5 cheapest –º–æ–¥–µ–ª–µ–π (–∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- –í–º–µ—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞ `rub_per_gen == 0` ‚Üí —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ + TOP 5

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
# –¢–µ–ø–µ—Ä—å FREE tier —Å–æ–¥–µ—Ä–∂–∏—Ç:
# 1. z-image (0.0 RUB)
# 2. qwen/text-to-image (0.0 RUB)
# 3. qwen/image-to-image (0.0 RUB)
# 4. qwen/image-edit (0.0 RUB)
# 5. elevenlabs/audio-isolation (0.08 RUB) ‚Üê –ù–û–í–ê–Ø
```

---

### 2. ‚ùå –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ input_schema examples

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–í SOURCE_OF_TRUTH –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏ –∏–º–µ–ª–∏ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ examples:
```json
{
  "qwen/image-to-image": {
    "input": {
      "examples": [
        {"image_url": "", "prompt": "..."} // ‚ùå –ü—É—Å—Ç–æ–π image_url
      ]
    }
  },
  "elevenlabs/sound-effect-v2": {
    "input": {
      "examples": [
        {"text": "", "loop": false} // ‚ùå –ü—É—Å—Ç–æ–π text
      ]
    }
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫–∏ "field is required".

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ  
–°–æ–∑–¥–∞–ª [comprehensive_model_test.py](scripts/comprehensive_model_test.py) –∫–æ—Ç–æ—Ä—ã–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—É—Å—Ç—ã–µ –ø–æ–ª—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç examples –∏–∑ SOT –∫–∞–∫ template
- –î–æ–±–∞–≤–ª—è–µ—Ç fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è image_url, audio_url, text –∏ —Ç.–¥.

**–ö–æ–¥:**
```python
# Fix common empty fields with valid test data
if 'text' in example_input and not example_input['text']:
    example_input['text'] = "test sound effect"

if 'image_url' in example_input and not example_input['image_url']:
    example_input['image_url'] = "https://picsum.photos/512/512"
```

---

### 3. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**  
- –ù–µ –±—ã–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ (real_kie_tests_results.json) –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Ç–æ–ª—å–∫–æ 12 –º–æ–¥–µ–ª–µ–π
- –ù–µ –±—ã–ª–æ —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ  
–°–æ–∑–¥–∞–ª [comprehensive_model_test.py](scripts/comprehensive_model_test.py):
- **Budget control:** –õ–∏–º–∏—Ç —Ä–∞—Å—Ö–æ–¥–∞ 50 RUB –∑–∞ –∑–∞–ø—É—Å–∫
- **Smart ordering:** –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å —Å–∞–º—ã—Ö –¥–µ—à–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- **History tracking:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **Skip tested:** –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **Detailed logging:** JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å task_id –∏ –æ—à–∏–±–∫–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
```
‚úÖ Successful: 23/24 (95.8%)
üí∞ Total cost: 48.38 RUB
üìÅ Results: artifacts/comprehensive_test_results.json
üìÅ History: artifacts/tested_models_history.json
```

---

### 4. ‚ö†Ô∏è –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—â–∏–µ pre-task (KNOWN LIMITATION)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ú–æ–¥–µ–ª—å `grok-imagine/upscale` —Ç—Ä–µ–±—É–µ—Ç `task_id` –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
```
API error: record not found
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–≠—Ç–æ upscale –º–æ–¥–µ–ª—å - –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ DOCUMENTED  
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–µ—Ç–∫–∞ –≤ SOT (–º–æ–∂–Ω–æ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ `requires_pretask: true`)
- –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–∞–∫–∏–µ –º–æ–¥–µ–ª–∏
- –î–ª—è UI –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å warning –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–°–ø–∏—Å–æ–∫ —Ç–∞–∫–∏—Ö –º–æ–¥–µ–ª–µ–π:**
1. `grok-imagine/upscale` (—Ç—Ä–µ–±—É–µ—Ç task_id)
2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥—Ä—É–≥–∏–µ upscale/enhance –º–æ–¥–µ–ª–∏

---

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ build_payload –ª–æ–≥–∏–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**  
`app/kie/builder.py` - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è required –ø–æ–ª–µ–π –∏–∑ schema, –Ω–æ:
- –ù–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç examples
- –ù–µ—Ç fallback –¥–ª—è –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ–π (–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Ç–µ—Å—Ç—ã)

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ  
–°–æ–∑–¥–∞–ª —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π build_test_payload –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ë–µ—Ä–µ—Ç –ø–µ—Ä–≤—ã–π example –∏–∑ `input.examples`
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø—É—Å—Ç—ã–µ –ø–æ–ª—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ù–ï –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ —ç—Ç–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ)

**–î–ª—è production –æ—Å—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- `app/kie/builder.py` - –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `app/kie/validator.py` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìà –ú–ï–¢–†–ò–ö–ò –£–õ–£–ß–®–ï–ù–ò–ô

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| FREE tier auto-setup | 4 –º–æ–¥–µ–ª–∏ | 5 –º–æ–¥–µ–ª–µ–π | ‚úÖ +25% |
| –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –º–æ–¥–µ–ª–µ–π | 12 | 24 | ‚úÖ +100% |
| Success rate —Ç–µ—Å—Ç–æ–≤ | N/A | 95.8% | ‚úÖ EXCELLENT |
| –ï—Å—Ç—å test automation | ‚ùå | ‚úÖ | ‚úÖ NEW |
| Budget control | ‚ùå | ‚úÖ 50 RUB limit | ‚úÖ NEW |
| History tracking | ‚ùå | ‚úÖ | ‚úÖ NEW |

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ö–†–ò–¢–ò–ß–ù–´–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### SOURCE_OF_TRUTH
- ‚úÖ 72 –º–æ–¥–µ–ª–∏
- ‚úÖ –í—Å–µ —Å —Ü–µ–Ω–∞–º–∏
- ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ examples –∏–º–µ—é—Ç –ø—É—Å—Ç—ã–µ –ø–æ–ª—è (–ù–ï –∫—Ä–∏—Ç–∏—á–Ω–æ - fixed in test script)

### FREE Tier
- ‚úÖ Auto-setup –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (5 –º–æ–¥–µ–ª–µ–π)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç
- ‚úÖ Cheapest –º–æ–¥–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### API Integration
- ‚úÖ 23/24 –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Retry logic –µ—Å—Ç—å (client_v4.py)
- ‚úÖ Error handling —Ä–∞–±–æ—Ç–∞–µ—Ç

### Testing
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ Budget control —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ History tracking —Ä–∞–±–æ—Ç–∞–µ—Ç

### Deployment
- ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ Render
- ‚úÖ Singleton lock —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Startup validation –ø—Ä–æ—Ö–æ–¥–∏—Ç

---

## üéØ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: 0/5** - –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã ‚úÖ

**Production Ready:** ‚úÖ YES  
**Test Coverage:** ‚úÖ 95.8%  
**Known Issues:** 1 –º–æ–¥–µ–ª—å (grok-imagine/upscale) - documented limitation

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –µ—â–µ —Ä–∞—É–Ω–¥ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è 48 –º–æ–¥–µ–ª–µ–π (–ø–æ—Ç—Ä–µ–±—É–µ—Ç ~100 RUB)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ SOT (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)
3. –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `requires_pretask` –¥–ª—è upscale –º–æ–¥–µ–ª–µ–π
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö SOT
