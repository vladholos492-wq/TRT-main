# –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –±–∏–∑–Ω–µ—Å-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

## –ú–æ–¥—É–ª–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. `pricing_transparency.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `set_param:` (—Å—Ç—Ä–æ–∫–∞ 4727) –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–Ω—ã –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `update_price_on_parameter_change()` –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ –≤–ª–∏—è–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–∞ —Ü–µ–Ω—É —á–µ—Ä–µ–∑ `get_price_hint_for_parameter()`

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (—Å—Ç—Ä–æ–∫–∞ 4772)
from pricing_transparency import update_price_on_parameter_change, get_price_hint_for_parameter

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Ü–µ–Ω—É
model_id = session.get('model_id')
if model_id:
    price_info = update_price_on_parameter_change(model_id, params, param_name, param_value)
    price_hint = get_price_hint_for_parameter(param_name, param_value, user_lang)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–Ω–µ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
    price_text = f"\n\nüí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {price_info['total_price']:.2f} ‚ÇΩ"
    if price_hint:
        price_text += f"\nüí° {price_hint}"
```

---

### 2. `price_confirmation.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ—à–∞–≥–æ–≤–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ 4806) –Ω–∞ `show_price_confirmation()`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ `CONFIRMING_GENERATION`

**–ü—Ä–∏–º–µ—Ä:**
```python
# –í–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫ 4806-4814
from price_confirmation import show_price_confirmation
from bonus_system import get_user_bonuses, get_active_discount

model_id = session.get('model_id')
model_info = session.get('model_info', {})
model_name = model_info.get('name', model_id)

# –ü–æ–ª—É—á–∞–µ–º –±–æ–Ω—É—Å—ã –∏ —Å–∫–∏–¥–∫–∏
bonuses = get_user_bonuses(user_id)
bonus_available = bonuses.get('bonus_balance', 0.0)
discount = get_active_discount(user_id)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É
price = calculate_price_rub(model_id, params, is_admin_user)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
await show_price_confirmation(
    context.bot,
    chat_id,
    model_id,
    model_name,
    params,
    price,
    user_id,
    user_lang,
    is_free,
    bonus_available,
    discount
)
return CONFIRMING_GENERATION
```

---

### 3. `balance_notifications.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–ø–∏—Å–∞–Ω–∏–∏ –∏ –±–∞–ª–∞–Ω—Å–µ

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –ü–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (—Å—Ç—Ä–æ–∫–∞ 23007) –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ (—Å—Ç—Ä–æ–∫–∞ 10432) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `send_insufficient_balance_message()`

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ü–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 23007)
from balance_notifications import send_balance_deduction_notification
from bonus_system import get_user_bonuses

# –ü–æ–ª—É—á–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è –±–∞–ª–∞–Ω—Å
remaining_balance = get_user_balance(user_id)
bonuses = get_user_bonuses(user_id)
bonus_used = 0.0  # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏

await send_balance_deduction_notification(
    context.bot,
    chat_id,
    user_id,
    price,
    model_name,
    remaining_balance,
    bonus_used,
    user_lang
)

# –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ (—Å—Ç—Ä–æ–∫–∞ 10432)
from balance_notifications import send_insufficient_balance_message
from bonus_system import get_user_bonuses

bonuses = get_user_bonuses(user_id)
bonus_available = bonuses.get('bonus_balance', 0.0)

await send_insufficient_balance_message(
    context.bot,
    chat_id,
    price,
    user_balance,
    bonus_available,
    user_lang
)
```

---

### 4. `bonus_system.py`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤ –∏ —Å–∫–∏–¥–æ–∫

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ü–µ–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å–∫–∏–¥–∫–∏ –∏ –±–æ–Ω—É—Å—ã
- –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–æ–Ω—É—Å–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ-–∫–æ–¥–æ–≤

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤:**
```python
from bonus_system import get_user_bonuses, use_bonus, get_active_discount

# –ü–æ–ª—É—á–∞–µ–º –±–æ–Ω—É—Å—ã –∏ —Å–∫–∏–¥–∫—É
bonuses = get_user_bonuses(user_id)
bonus_balance = bonuses.get('bonus_balance', 0.0)
discount = get_active_discount(user_id)

# –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É
if discount:
    price = price * (1 - discount)

# –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã
bonus_used = 0.0
if bonus_balance > 0 and price > 0:
    if bonus_balance >= price:
        bonus_used = price
        use_bonus(user_id, bonus_used, f'–ì–µ–Ω–µ—Ä–∞—Ü–∏—è {model_id}')
        price = 0.0
    else:
        bonus_used = bonus_balance
        use_bonus(user_id, bonus_used, f'–ì–µ–Ω–µ—Ä–∞—Ü–∏—è {model_id}')
        price = price - bonus_used
```

---

## –ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è pricing_transparency:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑ —Ü–µ–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ –≤–ª–∏—è–Ω–∏–∏ –Ω–∞ —Ü–µ–Ω—É

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è price_confirmation:**
   - –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–µ
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ–Ω—É—Å–∞—Ö –∏ —Å–∫–∏–¥–∫–∞—Ö

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è bonus_system:**
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –±–æ–Ω—É—Å—ã –∏ —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ü–µ–Ω—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è balance_notifications:**
   - –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è
   - –£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. ‚úÖ –¶–µ–Ω–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
3. ‚úÖ –ë–æ–Ω—É—Å—ã –∏ —Å–∫–∏–¥–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–ø–∏—Å–∞–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
5. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

