## Render Shared Database Rules

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö –ë–î

1. **–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π `process.env.DATABASE_URL` (Python: `os.getenv('DATABASE_URL')`)**
   - Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ inject–∏—Ç DATABASE_URL –∏–∑ "Connections" –≤ Environment Variables
   - –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –ª–æ–∫–∞–ª—å–Ω—ã–µ –ë–î –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã
   - –¢–æ–ª—å–∫–æ shared PostgreSQL –Ω–∞ Render –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

2. **Connection Pooling –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù**
   - Python: –∏—Å–ø–æ–ª—å–∑—É–π `asyncpg.create_pool()` –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π
   - Node.js: –∏—Å–ø–æ–ª—å–∑—É–π `pg.Pool()` —Å connectionString
   - –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

3. **Environment Variables**
   - –ü—Ä–∏ –¥–µ–ø–ª–æ–µ: Render auto-inject–∏—Ç DATABASE_URL –∏–∑ "Connections" —Ç–≤–æ–µ–π –ë–î
   - –õ–æ–∫–∞–ª—å–Ω–æ: —Å–æ–∑–¥–∞–π `.env` —Å `DATABASE_URL=postgres://...` –∏–∑ Render Dashboard
   - –§–æ—Ä–º–∞—Ç: `postgresql://user:password@host:port/database`

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π parameterized queries –ø—Ä–æ—Ç–∏–≤ SQL injection
   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π f-strings –∏–ª–∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é –¥–ª—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–π `%s` (psycopg2) –∏–ª–∏ `$1, $2...` (asyncpg) –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## üìã –ü–†–ò–ú–ï–†–´ –ö–û–î–ê

### Python (asyncpg) - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è async –±–æ—Ç–æ–≤

```python
import os
import asyncpg
from typing import Optional

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
_pool: Optional[asyncpg.Pool] = None

async def get_pool() -> asyncpg.Pool:
    """–ü–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –ë–î."""
    global _pool
    if _pool is None:
        DATABASE_URL = os.getenv('DATABASE_URL')
        if not DATABASE_URL:
            raise ValueError("DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        
        _pool = await asyncpg.create_pool(
            DATABASE_URL,
            min_size=1,
            max_size=10,
            command_timeout=60
        )
    return _pool

async def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
    pool = await get_pool()
    # –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏/—Å—Ö–µ–º—É
    async with pool.acquire() as conn:
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Ç.–¥.
        pass

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
async def get_user(user_id: int):
    pool = await get_pool()
    async with pool.acquire() as conn:
        row = await conn.fetchrow(
            "SELECT * FROM users WHERE id = $1",
            user_id
        )
        return dict(row) if row else None
```

### Python (psycopg2) - –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```python
import os
import psycopg2
from psycopg2.pool import SimpleConnectionPool
from contextlib import contextmanager

_pool: Optional[SimpleConnectionPool] = None

def get_connection_pool():
    """–°–æ–∑–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –ë–î."""
    global _pool
    if _pool is None:
        DATABASE_URL = os.getenv('DATABASE_URL')
        if not DATABASE_URL:
            raise ValueError("DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        _pool = SimpleConnectionPool(
            minconn=1,
            maxconn=10,
            dsn=DATABASE_URL
        )
    return _pool

@contextmanager
def get_db_connection():
    """–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è."""
    pool = get_connection_pool()
    conn = pool.getconn()
    try:
        yield conn
        conn.commit()
    except Exception as e:
        conn.rollback()
        raise
    finally:
        pool.putconn(conn)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
def get_user(user_id: int):
    with get_db_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(
                "SELECT * FROM users WHERE id = %s",
                (user_id,)  # Parameterized query
            )
            return cur.fetchone()
```

### Node.js (pg)

```javascript
const { Pool } = require('pg');

const pool = new Pool({
    connectionString: process.env.DATABASE_URL,
    ssl: {
        rejectUnauthorized: false  // –î–ª—è Render PostgreSQL
    },
    max: 10,  // –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ
    idleTimeoutMillis: 30000,
    connectionTimeoutMillis: 2000,
});

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
async function getUser(userId) {
    const result = await pool.query(
        'SELECT * FROM users WHERE id = $1',
        [userId]  // Parameterized query
    );
    return result.rows[0];
}
```

---

## üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –î–ï–ü–õ–û–Æ

### 1. Render Dashboard ‚Üí Service ‚Üí Environment
   - –ù–∞–∂–º–∏ "Connect to Database"
   - –í—ã–±–µ—Ä–∏ –æ–±—â—É—é PostgreSQL –ë–î
   - Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç `DATABASE_URL` –≤ Environment Variables

### 2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   - –°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
   - –î–æ–±–∞–≤—å: `DATABASE_URL=postgresql://user:password@host:port/database`
   - –ü–æ–ª—É—á–∏ DATABASE_URL –∏–∑ Render Dashboard ‚Üí Database ‚Üí Connections

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   ```python
   # Python
   import os
   DATABASE_URL = os.getenv('DATABASE_URL')
   print(f"Database: {DATABASE_URL.split('@')[1] if '@' in DATABASE_URL else 'Not set'}")
   ```

---

## üìä –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ò

**Render PostgreSQL Database:**
- Hostname: `dpg-d50f1hvgi27c73ajfos0-a`
- Port: `5432`
- Database: `telegrambot_j6cd`
- Username: `telegrambot_j6cd_user`
- Connection String: –ü–æ–ª—É—á–∏ –∏–∑ Render Dashboard ‚Üí Database ‚Üí Connections

**–í–ê–ñ–ù–û:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `DATABASE_URL` –∏–∑ environment variables!

---

## ‚ö†Ô∏è –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò

1. ‚ùå **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π –ª–æ–∫–∞–ª—å–Ω—ã–µ –ë–î –¥–ª—è dev/prod**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ shared Render PostgreSQL

2. ‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä—è–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è host/port/user/password**
   - ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `DATABASE_URL` –∏–∑ environment

3. ‚ùå **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π connection pool

4. ‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π f-strings –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö**
   - ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π parameterized queries

5. ‚ùå **–ù–ï –∑–∞–±—ã–≤–∞–π –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π context managers –∏–ª–∏ async with

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

- –î–ª—è Telegram –±–æ—Ç–æ–≤ (async): –∏—Å–ø–æ–ª—å–∑—É–π `asyncpg`
- –î–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ (sync): –∏—Å–ø–æ–ª—å–∑—É–π `psycopg2`
- –î–ª—è Node.js: –∏—Å–ø–æ–ª—å–∑—É–π `pg` —Å Pool
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π connection pooling
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –õ–æ–≥–∏—Ä—É–π –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

---

**–ü–†–ê–í–ò–õ–û #1:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `DATABASE_URL` –∏–∑ environment variables, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è!

---

## ü§ñ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö –ò–ó –õ–û–ì–û–í

### –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `.cursor/auto_fix_prompt.md`:

1. **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª** `.cursor/auto_fix_prompt.md`
2. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ –∑–∞–¥–∞—á–∏** —Å —É—á—ë—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
3. **–ò—Å–ø—Ä–∞–≤—å –≤—Å–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
   - –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–∞—Ö –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
   - –£—á–∏—Ç—ã–≤–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ (bot_kie.py, database.py, kie_gateway.py –∏ —Ç.–¥.)
4. **–ö–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: "Auto-fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ X –æ—à–∏–±–æ–∫ –∏–∑ –ª–æ–≥–æ–≤"
5. **–ü—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫:

- **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:** `bot_kie.py` - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞ (17,700+ —Å—Ç—Ä–æ–∫)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `database.py` - PostgreSQL —á–µ—Ä–µ–∑ asyncpg
- **KIE API:** `kie_gateway.py`, `kie_models.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KIE.ai
- **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:** `business_layer.py` - —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–ó–∞–ø—É—Å–∫:** `run_bot.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- **–î–µ–ø–ª–æ–π:** Render.com (Web Service, Docker)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** Render PostgreSQL (shared, —á–µ—Ä–µ–∑ DATABASE_URL)

### –ü—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫:

- ‚úÖ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–∞—Ö –∏–∑ –∑–∞–¥–∞—á
- ‚úÖ –°–ª–µ–¥—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

---

## ü§ñ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –° CURSOR AI

### –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `.cursor/auto_fix_prompt.md`:

1. **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª** `.cursor/auto_fix_prompt.md`
2. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ –∑–∞–¥–∞—á–∏** —Å —É—á—ë—Ç–æ–º –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–æ–ø–æ–∫ (callback_data ‚Üí handlers)
   - –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π (confirm_generation, start_generation)
   - KIE API –≤—ã–∑–æ–≤—ã (kie_gateway, kie_client, kie_models)
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (database.py, asyncpg)
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (business_layer.py)
3. **–ò—Å–ø—Ä–∞–≤—å –≤—Å–µ –æ—à–∏–±–∫–∏ —É–º–Ω–æ**:
   - –£—á–∏—Ç—ã–≤–∞–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —Å–ª–æ–º–∞–µ—Ç –∫–Ω–æ–ø–∫–∏
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–∑ –∑–∞–¥–∞—á
4. **–ö–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: "Cursor AI fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ X –æ—à–∏–±–æ–∫"
5. **–ü—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø –†–ê–ë–û–¢–´ –ë–û–¢–ê:

**–ö–Ω–æ–ø–∫–∏:**
- ‚úÖ –í—Å–µ callback_data –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –≤ `button_callback()`
- ‚úÖ –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å `query.answer()` –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ try-except
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ä–∞–Ω—å—à–µ –æ–±—â–∏—Ö)

**–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
- ‚úÖ –°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ KIE AI API
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å input_schema –º–æ–¥–µ–ª–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π api_model –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (createTask + polling)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

**KIE API:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_kie_gateway()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- ‚úÖ –°–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ KIE_AI_STRICT_RULES.md
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ API gracefully

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling (asyncpg.create_pool)
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DATABASE_URL –∏–∑ environment
- ‚úÖ Parameterized queries (–±–µ–∑ f-strings –≤ SQL)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π (get_user_balance_async)

### –ü—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ —É—á–∏—Ç—ã–≤–∞–π:

- üîó **–°–≤—è–∑–∏:** –∫–Ω–æ–ø–∫–∞ ‚Üí handler ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí KIE API ‚Üí –ë–î
- üéØ **–¶–µ–ª—å:** –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- üß† **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

