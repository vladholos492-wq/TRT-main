# Render Blueprint для Kie.ai Telegram Bot
# https://render.com/docs/blueprint-spec

services:
  # PostgreSQL база для singleton lock и хранения данных
  - type: pserv
    name: kie-bot-db
    plan: starter  # или free для тестов
    databaseName: kie_bot
    databaseUser: kie_user
    ipAllowList: []  # разрешить все подключения внутри Render

  # Web Service для Telegram бота (webhook mode)
  - type: web
    name: kie-bot-production
    runtime: python3
    plan: starter  # или free (засыпает после 15 минут)
    buildCommand: pip install -r requirements.txt
    startCommand: python main_render.py
    healthCheckPath: /health
    
    envVars:
      # ⚠️ СЕКРЕТЫ УСТАНОВИТЬ ВРУЧНУЮ ЧЕРЕЗ RENDER UI
      # НЕ КОММИТИТЬ В GIT!
      
      - key: BOT_MODE
        value: webhook
        
      - key: INSTANCE_NAME
        value: prod-bot-1
        
      - key: LOG_LEVEL
        value: INFO
        
      # Database URL (автоматически заполнится из pserv выше)
      - key: DATABASE_URL
        fromDatabase:
          name: kie-bot-db
          property: connectionString
      
      # ⚠️ Добавить вручную в Render Dashboard:
      # - TELEGRAM_BOT_TOKEN
      # - KIE_API_KEY
      # - ADMIN_ID
